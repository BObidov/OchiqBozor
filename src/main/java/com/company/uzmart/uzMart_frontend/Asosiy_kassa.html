<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>POS - Klaviatura</title>
    <link rel="stylesheet" href="Asosiy_kassa.css">
</head>
<body>
<div class="container">
    <!-- Chap bo‘sh blok -->
    <div class="left-box">
        <div class="product-toolbar-row">
            <div class="product-card">
                <button onclick="window.location.href='shtrix_kodsiz_tovarlar.html'">Shtrix<br>kodsiz<br>tovarlar_1</button>
            </div>
            <div class="product-card">
                <button onclick="window.location.href='shtrix_kodsiz_tovarlar_2.html'">Shtrix<br>kodsiz<br>tovarlar_2</button>
            </div>
            <div class="product-card">
                <img src="non.png" alt="non">
                <p>non</p>
            </div>
            <div class="product-card">
                <img src="qovun.png" alt="qovun">
                <p>qovun</p>
            </div>
            <div class="product-card">
                <img src="tarvuz.png" alt="tarvuz">
                <p>tarvuz</p>
            </div>
            <div class="product-card">
                <img src="tuxum.png" alt="tuxum">
                <p>tuxum</p>
            </div>
            <div class="product-card">
                <img src="sovun.png" alt="sovun">
                <p>sovun</p>
            </div>
        </div>

    </div>


    <!-- O‘ng blok -->
    <div class="right-box">
        <div class="keyboard-section">
            <div class="keyboard-frame">
                <div class="keyboard">
                    <input type="text" id="barcodeInput" placeholder="Shtrix kod yozish uchun" readonly>

                    <div class="keypad">
                        <button onclick="appendNumber('1')">1</button>
                        <button onclick="appendNumber('2')">2</button>
                        <button onclick="appendNumber('3')">3</button>

                        <button onclick="appendNumber('4')">4</button>
                        <button onclick="appendNumber('5')">5</button>
                        <button onclick="appendNumber('6')">6</button>

                        <button onclick="appendNumber('7')">7</button>
                        <button onclick="appendNumber('8')">8</button>
                        <button onclick="appendNumber('9')">9</button>

                        <button onclick="appendNumber('*')">*</button>
                        <button onclick="appendNumber('0')">0</button>
                        <button onclick="appendNumber('-')">-</button>

                        <button onclick="deleteLast()">delete</button>
                        <button class="cancel" style="grid-column: span 2;">Bekor qilish</button>
                    </div>

                    <a href="Tolov_usuli.html" class="pay-button">To‘lovga o‘tish</a>

                </div>
            </div>

            <!-- Kassa tugmalari -->
            <div class="main-cash-button">
                <button>Asosiy kassa</button>
            </div>

            <!-- Kassa 2 va 3 yonma-yon -->
            <div class="sub-cash-buttons">
                <button onclick="window.location.href='Kassa_2.html'">Kassa 2</button>
                <button onclick="window.location.href='Kassa_3.html'">Kassa 3</button>
            </div>
        </div>

        <!-- O‘ng yon panel (2ta ustun) -->
        <div class="side-panels">
            <div class="panel"></div>
            <div class="panel"></div>
        </div>
    </div>
</div>

<script>
    function appendNumber(num) {
        const input = document.getElementById("barcodeInput");
        input.value += num;
    }

    function deleteLast() {
        const input = document.getElementById("barcodeInput");
        input.value = input.value.slice(0, -1);
    }

    // Barcode yozilsa avtomatik qidiruv
    document.getElementById("barcodeInput").addEventListener("input", function () {
        const value = this.value;
        if (value.length > 0) {
            fetch(`http://localhost:8080/api/products/get?barcode=${value}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Serverdan javob yo'q");
                    }
                    return response.json();
                })
                .then(data => {
                    const resultPanel = document.querySelector(".side-panels .panel:first-child");
                    resultPanel.innerHTML = "";
                    if (Array.isArray(data) && data.length > 0) {
                        const table = document.createElement("table");
                        table.style.width = "100%";
                        table.style.borderCollapse = "collapse";
                        table.style.fontSize = "14px";

                        data.forEach(product => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                                <td style="border: 1px solid black; padding: 4px;">${product.name}</td>
                                <td style="border: 1px solid black; padding: 4px;">(${product.amount})</td>
                                <td style="border: 1px solid black; padding: 4px;">${product.price} so'm</td>
                            `;
                            row.style.cursor = "pointer";
                            row.onclick = () => {
                                addToSelected(product);
                            };
                            table.appendChild(row);
                        });

                        resultPanel.appendChild(table);
                    } else {
                        resultPanel.innerHTML = "<p>Hech narsa topilmadi.</p>";
                    }
                })
                .catch(error => {
                    console.error("Xatolik:", error);
                });
        }
    });

    function addToSelected(product) {
        const bottomPanel = document.querySelector(".side-panels .panel:last-child");
        const div = document.createElement("div");
        div.textContent = `${product.name} - ${product.price} so'm`;
        div.style.border = "1px solid #000";
        div.style.padding = "4px";
        div.style.margin = "2px";
        bottomPanel.appendChild(div);
    }
</script>

</body>
</html>
